<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width,initial-scale=1">
<title>UTSAV 2025 ‚Äî Quiz</title>
<link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
<style>
:root{--accent:#00d4ff;--gold:#ffcc00;--bg1:#08121a;--bg2:#19232b;}
body{margin:0;font-family:'Poppins',sans-serif;background:linear-gradient(180deg,var(--bg1),var(--bg2));color:#fff;}
.wrap{max-width:920px;margin:28px auto;padding:22px;background:rgba(255,255,255,0.03);border-radius:14px;}
header{display:flex;justify-content:space-between;align-items:center;flex-wrap:wrap}
h1{margin:0;color:var(--accent);font-size:1.9rem}
.subtitle{color:#bfefff;font-size:.95rem}
.panel{background:rgba(255,255,255,0.02);padding:18px;border-radius:12px;margin-top:16px}
input[type=text]{width:72%;padding:10px;border-radius:10px;border:0;margin:8px 0;font-size:1rem}
button.primary{background:var(--gold);color:#000;border:0;padding:10px 16px;border-radius:10px;cursor:pointer;font-weight:700}
.scorebar{display:flex;justify-content:space-between;align-items:center;padding:8px 12px;border-radius:10px;background:rgba(255,255,255,0.03);margin-bottom:12px}
.timer{color:var(--gold);font-weight:700}
.question{font-size:1.05rem;margin:14px 0;min-height:60px}
.options{display:flex;flex-direction:column;gap:10px;margin-top:8px}
.option{background:#fff;color:#000;border:2px solid rgba(0,0,0,0.12);border-radius:10px;padding:12px;cursor:pointer;width:80%;margin:0 auto;font-weight:700;transition:transform .12s,box-shadow .12s}
.option:hover{transform:scale(1.02)}
.option.correct{background:#28a745;color:#fff}
.option.wrong{background:#dc3545;color:#fff}
.logo-img{display:block;margin:12px auto;max-width:220px;border-radius:8px}
.round-title{font-weight:700;color:var(--accent);margin:8px 0}
.leader{margin-top:18px;padding:12px;border-radius:10px;background:rgba(255,255,255,0.02)}
table{width:100%;border-collapse:collapse;color:#fff}
th,td{padding:10px;border-bottom:1px solid rgba(255,255,255,0.03);text-align:left}
th{background:rgba(255,255,255,0.02)}
.loader{width:24px;height:24px;border:3px solid #fff;border-top:3px solid transparent;border-radius:50%;animation:spin 1s linear infinite;margin:auto}
@keyframes spin{to{transform:rotate(360deg)}}
.confetti{position:fixed;pointer-events:none;z-index:9999}
@media(max-width:720px){.option{width:92%}input[type=text]{width:88%}}
</style>
</head>
<body>
<div class="wrap">
<header>
  <div>
    <h1>UTSAV 2025 ‚Äî Quiz</h1>
    <div class="subtitle">Two rounds ‚Ä¢ 10 s per question ‚Ä¢ Auto-save leaderboard</div>
  </div>
  <div class="subtitle">Good luck üéâ</div>
</header>

<div id="startPanel" class="panel" style="text-align:center">
  <input id="playerNameInput" type="text" placeholder="Enter your name" autocomplete="off"><br>
  <button id="startBtn" class="primary">Start Game (5 + 5)</button>
</div>

<div id="quizPanel" class="panel" style="display:none">
  <div class="scorebar">
    <div>Player: <strong id="playerNameDisplay"></strong></div>
    <div>Round: <strong id="roundDisplay">1</strong></div>
    <div>Score: <strong id="scoreDisplay">0</strong></div>
    <div class="timer">‚è± <span id="timeLeft">10</span>s</div>
  </div>
  <div id="roundTitle" class="round-title"></div>
  <div id="questionBox">
    <div id="questionText" class="question"></div>
    <img id="logoImage" class="logo-img" style="display:none">
    <div id="optionsBox" class="options"></div>
  </div>
</div>

<div id="resultPanel" class="panel" style="display:none;text-align:center">
  <h2>üéâ Round Complete</h2>
  <p><b>Final Score:</b> <span id="finalScore">0</span></p>
  <p><b>Total Time Taken:</b> <span id="finalTime">0</span> seconds</p>
  <button id="replayBtn" class="primary">Play Again</button>
</div>

<div class="leader panel">
  <h3>üèÜ Live Leaderboard</h3>
  <div id="leaderLoad" class="loader"></div>
  <table>
    <thead><tr><th>Rank</th><th>Name</th><th>Score</th><th>Time (s)</th></tr></thead>
    <tbody id="leaderBody"></tbody>
  </table>
</div>
</div>

<audio id="soundCorrect" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0ff56c1a07.mp3?filename=correct-answer-4-145576.mp3"></audio>
<audio id="soundWrong" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_86b46f36c7.mp3?filename=error-126627.mp3"></audio>

<script>
const GOOGLE_SCRIPT_URL="https://script.google.com/macros/s/AKfycbxImguBnWjQFzk1PEXScmFrW4hCmlFRwVbGq_rVCfB7gAvcci12rKh6u8BuifJOURJkaQ/exec";
const SHEET_ID="1L6yYFs1BRqWRBNkRMReA_WYTQgPJf2QvCA-2tl9z6bc";
const ROUND1_COUNT=5,ROUND2_COUNT=5,TIME_PER_Q=10;

const IMAGE_POOL=[
 {img:"https://upload.wikimedia.org/wikipedia/commons/4/44/Tesla_logo.png",a:"Tesla",opts:["Tesla","Toyota","Hyundai","Tata"]},
 {img:"https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg",a:"Apple",opts:["Samsung","Sony","Apple","LG"]},
 {img:"https://upload.wikimedia.org/wikipedia/commons/0/08/Google_2015_logo.svg",a:"Google",opts:["Microsoft","Amazon","Google","Meta"]},
 {img:"https://upload.wikimedia.org/wikipedia/en/f/fd/Bigg_Boss_logo.png",a:"Bigg Boss",opts:["Bigg Boss","Roadies","Splitsvilla","Khatron Ke Khiladi"]},
 {img:"https://upload.wikimedia.org/wikipedia/en/3/35/Indian_Idol_logo.png",a:"Indian Idol",opts:["Sa Re Ga Ma Pa","Indian Idol","The Voice","Super Singer"]}
];

let playerName="",questions=[],current=0,score=0,timer=null,timeLeft=TIME_PER_Q,totalTime=0;

const startPanel=document.getElementById("startPanel"),quizPanel=document.getElementById("quizPanel"),
resultPanel=document.getElementById("resultPanel"),startBtn=document.getElementById("startBtn"),
nameInput=document.getElementById("playerNameInput"),playerNameDisplay=document.getElementById("playerNameDisplay"),
roundDisplay=document.getElementById("roundDisplay"),scoreDisplay=document.getElementById("scoreDisplay"),
timeLeftEl=document.getElementById("timeLeft"),questionText=document.getElementById("questionText"),
optionsBox=document.getElementById("optionsBox"),logoImage=document.getElementById("logoImage"),
finalScore=document.getElementById("finalScore"),finalTime=document.getElementById("finalTime"),
leaderBody=document.getElementById("leaderBody"),leaderLoad=document.getElementById("leaderLoad"),
correctSnd=document.getElementById("soundCorrect"),wrongSnd=document.getElementById("soundWrong"),
replayBtn=document.getElementById("replayBtn"),roundTitle=document.getElementById("roundTitle");

function shuffle(a){return a.sort(()=>Math.random()-.5);}
function decodeHTML(h){const t=document.createElement("textarea");t.innerHTML=h;return t.value;}

async function fetchEasyQuestions(n){
 try{const res=await fetch(`https://opentdb.com/api.php?amount=${n}&difficulty=easy&type=multiple`);
 const data=await res.json();return data.results.map(r=>({q:decodeHTML(r.question),
 options:shuffle([...r.incorrect_answers.map(decodeHTML),decodeHTML(r.correct_answer)]),
 a:decodeHTML(r.correct_answer)}));}catch(e){return[];}
}

async function buildGame(){
 const r1=await fetchEasyQuestions(ROUND1_COUNT*2);
 const round1=[...new Map(r1.map(i=>[i.q,i])).values()].slice(0,ROUND1_COUNT);
 const round2=shuffle(IMAGE_POOL).slice(0,ROUND2_COUNT)
   .map(i=>({q:"Guess the logo/show:",options:shuffle(i.opts),a:i.a,img:i.img}));
 questions=[...shuffle(round1),...shuffle(round2)];
}

startBtn.onclick=async()=>{
 playerName=nameInput.value.trim();if(!playerName)return alert("Enter your name first!");
 startPanel.style.display="none";quizPanel.style.display="block";
 playerNameDisplay.textContent=playerName;score=0;current=0;scoreDisplay.textContent="0";
 await buildGame();showQuestion();
};

function showQuestion(){
 clearInterval(timer);
 if(current>=questions.length)return finishGame();
 const q=questions[current];const round=current<ROUND1_COUNT?1:2;
 roundDisplay.textContent=round;roundTitle.textContent=round==1?"Round 1 ‚Äì General Knowledge":"Round 2 ‚Äì Logos & Shows";
 questionText.textContent=q.q;logoImage.style.display=q.img?"block":"none";
 if(q.img)logoImage.src=q.img;
 optionsBox.innerHTML="";
 q.options.forEach(opt=>{
  const b=document.createElement("button");b.className="option";b.textContent=opt;
  b.onclick=()=>selectAnswer(b,opt,q.a);optionsBox.appendChild(b);
 });
 timeLeft=TIME_PER_Q;timeLeftEl.textContent=timeLeft;
 timer=setInterval(()=>{timeLeft--;totalTime++;timeLeftEl.textContent=timeLeft;
  if(timeLeft<=0){clearInterval(timer);current++;showQuestion();}},1000);
}

function selectAnswer(btn,sel,correct){
 clearInterval(timer);
 const all=optionsBox.querySelectorAll(".option");all.forEach(x=>x.disabled=true);
 if(sel===correct){score++;btn.classList.add("correct");correctSnd.play();}
 else{btn.classList.add("wrong");wrongSnd.play();all.forEach(x=>{if(x.textContent===correct)x.classList.add("correct")});}
 scoreDisplay.textContent=score;setTimeout(()=>{current++;showQuestion();},800);
}

function finishGame(){
 clearInterval(timer);quizPanel.style.display="none";resultPanel.style.display="block";
 finalScore.textContent=score;finalTime.textContent=totalTime;spawnConfetti();
 saveScore(playerName,score,totalTime);setTimeout(loadLeaderboard,1500);
}

function saveScore(n,s,t){
 fetch(GOOGLE_SCRIPT_URL,{method:"POST",headers:{"Content-Type":"application/json"},
 body:JSON.stringify({name:n,score:s,time:t})}).catch(console.error);
}

function spawnConfetti(){
 for(let i=0;i<60;i++){const e=document.createElement("div");e.className="confetti";
 e.style.left=Math.random()*100+"vw";e.style.top="-10vh";e.style.width=(6+Math.random()*12)+"px";
 e.style.height=e.style.width;e.style.background=["#ffd700","#00d4ff","#ff6ec7","#6effa1"][Math.floor(Math.random()*4)];
 document.body.appendChild(e);
 e.animate([{transform:"translateY(0)"},{transform:`translateY(${window.innerHeight+200}px) rotate(720deg)`}],
 {duration:2000+Math.random()*1500,easing:"linear"});
 setTimeout(()=>e.remove(),3500);}
}

async function loadLeaderboard(){
  leaderLoad.style.display="block";
  leaderBody.innerHTML="";
  try {
    const res = await fetch(`https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json&tq&gid=0`);
    const text = await res.text();
    const json = JSON.parse(text.substring(text.indexOf("(")+1, text.lastIndexOf(")")));
    const rows = json.table.rows.map(r => r.c.map(c => c ? c.v : ""));
    let data = [];
    for (let r of rows) {
      if (r.length >= 3 && r[0] && r[1]) {
        data.push({ name: r[0], score: parseInt(r[1]) || 0, time: parseInt(r[2]) || 0 });
      }
    }
    data = data.sort((a,b) => b.score - a.score || a.time - b.time).slice(0,10);
    leaderBody.innerHTML = data.map((r,i)=>
      `<tr><td>${i+1}</td><td>${r.name}</td><td>${r.score}</td><td>${r.time}</td></tr>`
    ).join("");
  } catch (e) {
    console.error(e);
    leaderBody.innerHTML = "<tr><td colspan='4'>‚ö†Ô∏è Error loading leaderboard</td></tr>";
  }
  leaderLoad.style.display="none";
}

replayBtn.onclick=()=>{resultPanel.style.display="none";startPanel.style.display="block";};

loadLeaderboard();setInterval(loadLeaderboard,20000);
</script>
</body>
</html>
