<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>UTSAV 2026 QUIZ</title>
<style>
body {
  font-family: 'Poppins', sans-serif;
  background: radial-gradient(circle at top, #001f1f, #000);
  color: #fff;
  text-align: center;
  margin: 0;
  padding: 0;
}
.container {
  max-width: 750px;
  margin: 40px auto;
  background: rgba(255, 255, 255, 0.1);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 0 25px rgba(0, 255, 255, 0.4);
}
h1 {
  color: #00ffff;
  font-size: 2.4em;
  animation: glow 2s infinite alternate;
}
@keyframes glow {
  from { text-shadow: 0 0 10px #00ffff; }
  to { text-shadow: 0 0 25px #00ffff; }
}
.scoreboard {
  background: rgba(0, 255, 255, 0.2);
  padding: 10px;
  border-radius: 10px;
  font-weight: bold;
  margin-bottom: 20px;
}
.timer {
  font-size: 22px;
  color: #ffcc00;
  margin-bottom: 15px;
}
.question {
  font-size: 20px;
  margin: 20px 0;
}
.option {
  display: block;
  background: #00ffff33;
  border: 1px solid #00ffff;
  color: #fff;
  margin: 10px auto;
  padding: 12px;
  border-radius: 12px;
  width: 80%;
  cursor: pointer;
  transition: 0.3s;
}
.option:hover { background: #00ffff66; transform: scale(1.05); }
.correct { background: #00ff0077 !important; box-shadow: 0 0 20px #00ff00; }
.wrong { background: #ff000077 !important; box-shadow: 0 0 20px #ff0000; }
#startForm input {
  padding: 10px;
  border-radius: 10px;
  border: none;
  margin: 8px;
  width: 80%;
  text-align: center;
}
#startBtn {
  background: #00ffff;
  border: none;
  padding: 10px 25px;
  border-radius: 10px;
  cursor: pointer;
  font-size: 18px;
  transition: 0.3s;
}
#startBtn:hover { background: #00cccc; transform: scale(1.05); }
.logoImg {
  max-width: 150px;
  margin: 15px auto;
  display: block;
}
.leaderboard {
  margin-top: 40px;
  background: rgba(255, 255, 255, 0.05);
  padding: 20px;
  border-radius: 15px;
}
table {
  width: 100%;
  border-collapse: collapse;
  color: white;
  margin-top: 15px;
}
th, td { padding: 10px; border-bottom: 1px solid #00ffff55; }
th { background: rgba(0, 255, 255, 0.3); }
.confetti {
  position: fixed;
  width: 10px;
  height: 10px;
  background: gold;
  top: 0;
  animation: fall 3s linear infinite;
}
@keyframes fall {
  0% { transform: translateY(0) rotate(0); opacity: 1; }
  100% { transform: translateY(100vh) rotate(720deg); opacity: 0; }
}
</style>
</head>
<body>
<div class="container">
  <h1>üöÄ UTSAV 2026 QUIZ üöÄ</h1>

  <div id="startForm">
    <input type="text" id="name" placeholder="Enter Your Name" required><br>
    <button id="startBtn">Start Quiz</button>
  </div>

  <div id="quizBox" style="display:none;">
    <div class="scoreboard">Score: <span id="score">0</span></div>
    <div class="timer">‚è± Time Left: <span id="timeLeft">5</span>s</div>
    <div class="question" id="question"></div>
    <img id="logoImg" class="logoImg" style="display:none;">
    <div id="options"></div>
  </div>

  <div id="resultBox" style="display:none;">
    <h2 id="resultTitle">üéâ Quiz Completed üéâ</h2>
    <p>Your Final Score: <span id="finalScore"></span></p>
    <p>Total Time Taken: <span id="totalTime"></span> seconds</p>
    <button onclick="restartQuiz()">üîÅ Play Again</button>
  </div>

  <div class="leaderboard">
    <h2>üèÜ Live Leaderboard üèÜ</h2>
    <table>
      <thead><tr><th>Rank</th><th>Name</th><th>Score</th><th>Time (s)</th></tr></thead>
      <tbody id="leaderBody"><tr><td colspan="4">Loading...</td></tr></tbody>
    </table>
  </div>
</div>

<audio id="correctSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_0ff56c1a07.mp3?filename=correct-answer-4-145576.mp3"></audio>
<audio id="wrongSound" src="https://cdn.pixabay.com/download/audio/2022/03/15/audio_86b46f36c7.mp3?filename=error-126627.mp3"></audio>

<script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbztv5R1tC8-kMzO0dNNcjQkrc4HHHoUacniGoRJn-_ptvTwI_kHxqNUZLP5deCcd3BRog/exec";
const SHEET_ID = "1L6yYFs1BRqWRBNkRMReA_WYTQgPJf2QvCA-2tl9z6bc";

let score = 0, current = 0, timer, timeLeft = 5, totalTime = 0, userName = "", questions = [];

// Logo questions
const logoQuestions = [
  {q: "Guess the logo:", img: "https://upload.wikimedia.org/wikipedia/commons/4/44/Tesla_logo.png", options: ["Tesla", "Toyota", "SpaceX", "Tata"], a: "Tesla"},
  {q: "Guess the logo:", img: "https://upload.wikimedia.org/wikipedia/commons/a/a6/McDonalds_Golden_Arches.svg", options: ["Burger King", "KFC", "McDonald's", "Subway"], a: "McDonald's"},
  {q: "Guess the logo:", img: "https://upload.wikimedia.org/wikipedia/commons/0/08/Google_2015_logo.svg", options: ["Microsoft", "Amazon", "Google", "Meta"], a: "Google"},
  {q: "Guess the logo:", img: "https://upload.wikimedia.org/wikipedia/commons/6/6a/Pepsi_logo_2014.svg", options: ["Coca-Cola", "Pepsi", "Sprite", "Fanta"], a: "Pepsi"},
  {q: "Guess the logo:", img: "https://upload.wikimedia.org/wikipedia/commons/f/fa/Apple_logo_black.svg", options: ["Samsung", "Sony", "Apple", "LG"], a: "Apple"}
];

document.getElementById("startBtn").onclick = async () => {
  userName = document.getElementById("name").value.trim();
  if (!userName) return alert("Please enter your name!");
  document.getElementById("startForm").style.display = "none";
  document.getElementById("quizBox").style.display = "block";
  await fetchQuestions();
  startQuiz();
};

async function fetchQuestions() {
  const response = await fetch("https://opentdb.com/api.php?amount=7&type=multiple");
  const data = await response.json();
  const apiQ = data.results.map(q => ({
    q: decodeHTML(q.question),
    options: shuffle([...q.incorrect_answers.map(decodeHTML), decodeHTML(q.correct_answer)]),
    a: decodeHTML(q.correct_answer),
    img: null
  }));
  const mixed = [...apiQ, ...shuffle(logoQuestions).slice(0, 3)];
  questions = shuffle(mixed);
}

function decodeHTML(html) {
  const t = document.createElement("textarea");
  t.innerHTML = html;
  return t.value;
}

function shuffle(a) {
  return a.sort(() => Math.random() - 0.5);
}

function startQuiz() {
  score = 0;
  current = 0;
  totalTime = 0;
  loadQuestion();
}

function loadQuestion() {
  if (current >= questions.length) return endQuiz();
  clearInterval(timer); // stop previous timer
  const q = questions[current];
  document.getElementById("question").innerText = q.q;
  const logo = document.getElementById("logoImg");
  logo.style.display = q.img ? "block" : "none";
  if (q.img) logo.src = q.img;
  const opts = document.getElementById("options");
  opts.innerHTML = "";
  q.options.forEach(opt => {
    const b = document.createElement("button");
    b.className = "option";
    b.innerText = opt;
    b.onclick = () => checkAnswer(b, opt === q.a);
    opts.appendChild(b);
  });
  timeLeft = 5;
  document.getElementById("timeLeft").innerText = timeLeft;
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timeLeft").innerText = timeLeft;
    totalTime++;
    if (timeLeft <= 0) {
      clearInterval(timer);
      current++;
      loadQuestion();
    }
  }, 1000);
  document.getElementById("score").innerText = score;
}

function checkAnswer(btn, correct) {
  clearInterval(timer);
  const ok = document.getElementById("correctSound");
  const no = document.getElementById("wrongSound");
  if (correct) {
    score++;
    btn.classList.add("correct");
    ok.play();
  } else {
    btn.classList.add("wrong");
    no.play();
  }
  document.getElementById("score").innerText = score;
  setTimeout(() => {
    current++;
    loadQuestion();
  }, 800);
}

function endQuiz() {
  clearInterval(timer); // ‚úÖ stop timer
  document.getElementById("quizBox").style.display = "none";
  document.getElementById("resultBox").style.display = "block";
  document.getElementById("finalScore").innerText = score;
  document.getElementById("totalTime").innerText = totalTime;
  spawnConfetti();
  saveScore(userName, score, totalTime);
  setTimeout(loadLeaderboard, 2000);
}

function saveScore(n, s, t) {
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ name: n, score: s, time: t }),
    headers: { "Content-Type": "application/json" }
  })
    .then(r => r.json())
    .then(d => console.log("Saved", d))
    .catch(e => console.error(e));
}

function loadLeaderboard() {
  const url = `https://docs.google.com/spreadsheets/d/${SHEET_ID}/gviz/tq?tqx=out:json`;
  fetch(url)
    .then(r => r.text())
    .then(t => {
      const json = JSON.parse(t.substr(47).slice(0, -2));
      const rows = json.table.rows.map(r => ({
        name: r.c[0]?.v,
        score: parseInt(r.c[2]?.v || 0),
        time: parseInt(r.c[3]?.v || 0)
      }));
      const sorted = rows.sort((a, b) => b.score - a.score || a.time - b.time);
      const tb = document.getElementById("leaderBody");
      tb.innerHTML = "";
      sorted.slice(0, 10).forEach((r, i) => {
        const tr = document.createElement("tr");
        tr.innerHTML = `<td>${i + 1}</td><td>${r.name}</td><td>${r.score}</td><td>${r.time}</td>`;
        tb.appendChild(tr);
      });
    })
    .catch(() => (document.getElementById("leaderBody").innerHTML = "<tr><td colspan='4'>Error loading leaderboard</td></tr>"));
}

function restartQuiz() {
  document.getElementById("resultBox").style.display = "none";
  document.getElementById("startForm").style.display = "block";
}

function spawnConfetti() {
  for (let i = 0; i < 50; i++) {
    const c = document.createElement("div");
    c.className = "confetti";
    c.style.left = Math.random() * 100 + "vw";
    c.style.backgroundColor = ["gold", "cyan", "magenta", "lime"][Math.floor(Math.random() * 4)];
    c.style.animationDuration = 2 + Math.random() * 3 + "s";
    document.body.appendChild(c);
    setTimeout(() => c.remove(), 3000);
  }
}

loadLeaderboard();
</script>
</body>
</html>
