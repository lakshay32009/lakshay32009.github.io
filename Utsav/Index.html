<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<title>Utsav 2025 Quiz</title>
<style>
body {
  font-family: "Poppins", sans-serif;
  background: linear-gradient(135deg, #1f1c2c, #928dab);
  color: white;
  margin: 0;
  padding: 0;
  text-align: center;
}
.container {
  max-width: 800px;
  margin: 40px auto;
  background: rgba(255,255,255,0.1);
  padding: 30px;
  border-radius: 20px;
  box-shadow: 0 0 20px rgba(0,0,0,0.3);
}
h1 {
  font-size: 2.2em;
  color: #ffeb3b;
  animation: fadeIn 1s ease-in-out;
}
button {
  background-color: #ffeb3b;
  border: none;
  color: black;
  padding: 10px 25px;
  border-radius: 8px;
  font-size: 16px;
  cursor: pointer;
  transition: 0.3s;
}
button:hover {
  background-color: #fff176;
}
.option {
  display: block;
  background-color: white;
  color: black;
  border: 2px solid #444;
  border-radius: 10px;
  padding: 10px;
  margin: 8px auto;
  cursor: pointer;
  width: 80%;
  transition: 0.3s;
}
.option:hover {
  background-color: #f0f0f0;
}
.correct { background-color: #4caf50 !important; color: white; }
.wrong { background-color: #f44336 !important; color: white; }
#leaderboard {
  margin-top: 30px;
  background: rgba(255,255,255,0.15);
  border-radius: 10px;
  padding: 15px;
}
table {
  width: 100%;
  border-collapse: collapse;
  color: white;
}
th, td {
  border-bottom: 1px solid #ddd;
  padding: 10px;
}
@keyframes fadeIn {
  from {opacity: 0; transform: translateY(-10px);}
  to {opacity: 1; transform: translateY(0);}
}
</style>
</head>
<body>
  <div class="container" id="startPage">
    <h1>Welcome to Utsav 2025 Quiz üéâ</h1>
    <p>Test your knowledge ‚Äî GK, Food, Fashion, Automobiles, and more!</p>
    <input type="text" id="nameInput" placeholder="Enter your name" style="padding:8px;border-radius:6px;border:none;">
    <br><br>
    <button onclick="startQuiz()">Start Quiz</button>
  </div>

  <div class="container" id="quizPage" style="display:none;">
    <h1 id="questionText">Question</h1>
    <div id="options"></div>
    <p id="timer">Time left: <span id="timeLeft">5</span>s</p>
  </div>

  <div class="container" id="resultPage" style="display:none;">
    <h1>Quiz Complete!</h1>
    <h2 id="scoreText"></h2>
    <h3 id="timeText"></h3>
    <button onclick="showLeaderboard()">View Leaderboard</button>
  </div>

  <div class="container" id="leaderboard" style="display:none;">
    <h1>Leaderboard üèÜ</h1>
    <table id="leaderboardTable">
      <tr><th>Name</th><th>Score</th><th>Time (s)</th></tr>
    </table>
    <br>
    <button onclick="restart()">Play Again</button>
  </div>

<script>
const GOOGLE_SCRIPT_URL = "https://script.google.com/macros/s/AKfycbxImguBnWjQFzk1PEXScmFrW4hCmlFRwVbGq_rVCfB7gAvcci12rKh6u8BuifJOURJkaQ/exec";
let playerName = "";
let score = 0;
let totalTime = 0;
let questionIndex = 0;
let questions = [];
let timer;
let timeLeft = 5;

// üß† Fetch random questions from OpenTriviaDB (unlimited variety)
async function fetchQuestions() {
  const res = await fetch("https://opentdb.com/api.php?amount=10&type=multiple");
  const data = await res.json();
  questions = data.results.map(q => ({
    question: decodeHTML(q.question),
    correct: decodeHTML(q.correct_answer),
    options: shuffle([...q.incorrect_answers.map(decodeHTML), decodeHTML(q.correct_answer)])
  }));
}

function decodeHTML(html) {
  const txt = document.createElement("textarea");
  txt.innerHTML = html;
  return txt.value;
}

function shuffle(array) {
  return array.sort(() => Math.random() - 0.5);
}

function startQuiz() {
  playerName = document.getElementById("nameInput").value.trim();
  if (!playerName) return alert("Please enter your name!");
  document.getElementById("startPage").style.display = "none";
  document.getElementById("quizPage").style.display = "block";
  loadQuiz();
}

async function loadQuiz() {
  await fetchQuestions();
  questionIndex = 0;
  score = 0;
  totalTime = 0;
  showQuestion();
}

function showQuestion() {
  if (questionIndex >= questions.length) return endQuiz();

  const q = questions[questionIndex];
  document.getElementById("questionText").textContent = q.question;
  const optionsDiv = document.getElementById("options");
  optionsDiv.innerHTML = "";
  q.options.forEach(opt => {
    const btn = document.createElement("button");
    btn.textContent = opt;
    btn.className = "option";
    btn.onclick = () => checkAnswer(opt, q.correct, btn);
    optionsDiv.appendChild(btn);
  });
  resetTimer();
}

function resetTimer() {
  clearInterval(timer);
  timeLeft = 5;
  document.getElementById("timeLeft").textContent = timeLeft;
  timer = setInterval(() => {
    timeLeft--;
    document.getElementById("timeLeft").textContent = timeLeft;
    totalTime++;
    if (timeLeft <= 0) {
      clearInterval(timer);
      questionIndex++;
      showQuestion();
    }
  }, 1000);
}

function checkAnswer(selected, correct, btn) {
  clearInterval(timer);
  const options = document.querySelectorAll(".option");
  options.forEach(b => b.disabled = true);
  if (selected === correct) {
    score++;
    btn.classList.add("correct");
    playSound("correct");
  } else {
    btn.classList.add("wrong");
    playSound("wrong");
  }
  setTimeout(() => {
    questionIndex++;
    showQuestion();
  }, 800);
}

function endQuiz() {
  document.getElementById("quizPage").style.display = "none";
  document.getElementById("resultPage").style.display = "block";
  document.getElementById("scoreText").textContent = `Your Score: ${score}`;
  document.getElementById("timeText").textContent = `Total Time: ${totalTime} sec`;
  uploadScore();
}

function uploadScore() {
  fetch(GOOGLE_SCRIPT_URL, {
    method: "POST",
    body: JSON.stringify({ name: playerName, score: score, time: totalTime }),
  }).catch(err => console.error("Upload error:", err));
}

function showLeaderboard() {
  document.getElementById("resultPage").style.display = "none";
  document.getElementById("leaderboard").style.display = "block";
  loadLeaderboard();
}

async function loadLeaderboard() {
  try {
    const res = await fetch(GOOGLE_SCRIPT_URL);
    const data = await res.json();
    const table = document.getElementById("leaderboardTable");
    table.innerHTML = "<tr><th>Name</th><th>Score</th><th>Time (s)</th></tr>";
    data.slice(1).reverse().forEach(row => {
      if (!row[0]) return;
      const tr = document.createElement("tr");
      tr.innerHTML = `<td>${row[0]}</td><td>${row[1]}</td><td>${row[2]}</td>`;
      table.appendChild(tr);
    });
  } catch (err) {
    console.error(err);
    alert("Error loading leaderboard!");
  }
}

function restart() {
  document.getElementById("leaderboard").style.display = "none";
  document.getElementById("startPage").style.display = "block";
}

function playSound(type) {
  const audio = new Audio(
    type === "correct"
      ? "https://actions.google.com/sounds/v1/cartoon/clang_and_wobble.ogg"
      : "https://actions.google.com/sounds/v1/cartoon/wood_plank_flicks.ogg"
  );
  audio.play();
}
</script>
</body>
</html>

